<div id="gist97989137" class="gist"> <div class="gist-file"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container file-box"> <div id="file-login_controller_test-go" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-go "> <table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip> <tr> <td id="file-login_controller_test-go-L1" class="blob-num js-line-number" data-line-number="1"></td> <td id="file-login_controller_test-go-LC1" class="blob-code blob-code-inner js-file-line"><span class=pl-k>package</span> controllers</td> </tr> <tr> <td id="file-login_controller_test-go-L2" class="blob-num js-line-number" data-line-number="2"></td> <td id="file-login_controller_test-go-LC2" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L3" class="blob-num js-line-number" data-line-number="3"></td> <td id="file-login_controller_test-go-LC3" class="blob-code blob-code-inner js-file-line"><span class=pl-k>import</span> (</td> </tr> <tr> <td id="file-login_controller_test-go-L4" class="blob-num js-line-number" data-line-number="4"></td> <td id="file-login_controller_test-go-LC4" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;encoding/json&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L5" class="blob-num js-line-number" data-line-number="5"></td> <td id="file-login_controller_test-go-LC5" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;io/ioutil&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L6" class="blob-num js-line-number" data-line-number="6"></td> <td id="file-login_controller_test-go-LC6" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;net/http&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L7" class="blob-num js-line-number" data-line-number="7"></td> <td id="file-login_controller_test-go-LC7" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L8" class="blob-num js-line-number" data-line-number="8"></td> <td id="file-login_controller_test-go-LC8" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/auth&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L9" class="blob-num js-line-number" data-line-number="9"></td> <td id="file-login_controller_test-go-LC9" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/models&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L10" class="blob-num js-line-number" data-line-number="10"></td> <td id="file-login_controller_test-go-LC10" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/responses&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L11" class="blob-num js-line-number" data-line-number="11"></td> <td id="file-login_controller_test-go-LC11" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/utils/formaterror&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L12" class="blob-num js-line-number" data-line-number="12"></td> <td id="file-login_controller_test-go-LC12" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;golang.org/x/crypto/bcrypt&quot;</span></td> </tr> <tr> <td id="file-login_controller_test-go-L13" class="blob-num js-line-number" data-line-number="13"></td> <td id="file-login_controller_test-go-LC13" class="blob-code blob-code-inner js-file-line">)</td> </tr> <tr> <td id="file-login_controller_test-go-L14" class="blob-num js-line-number" data-line-number="14"></td> <td id="file-login_controller_test-go-LC14" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L15" class="blob-num js-line-number" data-line-number="15"></td> <td id="file-login_controller_test-go-LC15" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>Login</span>(<span class=pl-s1>w</span> http.<span class=pl-smi>ResponseWriter</span>, <span class=pl-s1>r</span> <span class=pl-c1>*</span>http.<span class=pl-smi>Request</span>) {</td> </tr> <tr> <td id="file-login_controller_test-go-L16" class="blob-num js-line-number" data-line-number="16"></td> <td id="file-login_controller_test-go-LC16" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>body</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>ioutil</span>.<span class=pl-en>ReadAll</span>(<span class=pl-s1>r</span>.<span class=pl-c1>Body</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L17" class="blob-num js-line-number" data-line-number="17"></td> <td id="file-login_controller_test-go-LC17" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-login_controller_test-go-L18" class="blob-num js-line-number" data-line-number="18"></td> <td id="file-login_controller_test-go-LC18" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L19" class="blob-num js-line-number" data-line-number="19"></td> <td id="file-login_controller_test-go-LC19" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-login_controller_test-go-L20" class="blob-num js-line-number" data-line-number="20"></td> <td id="file-login_controller_test-go-LC20" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-login_controller_test-go-L21" class="blob-num js-line-number" data-line-number="21"></td> <td id="file-login_controller_test-go-LC21" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>user</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>User</span>{}</td> </tr> <tr> <td id="file-login_controller_test-go-L22" class="blob-num js-line-number" data-line-number="22"></td> <td id="file-login_controller_test-go-LC22" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>json</span>.<span class=pl-en>Unmarshal</span>(<span class=pl-s1>body</span>, <span class=pl-c1>&amp;</span><span class=pl-s1>user</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L23" class="blob-num js-line-number" data-line-number="23"></td> <td id="file-login_controller_test-go-LC23" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-login_controller_test-go-L24" class="blob-num js-line-number" data-line-number="24"></td> <td id="file-login_controller_test-go-LC24" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L25" class="blob-num js-line-number" data-line-number="25"></td> <td id="file-login_controller_test-go-LC25" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-login_controller_test-go-L26" class="blob-num js-line-number" data-line-number="26"></td> <td id="file-login_controller_test-go-LC26" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-login_controller_test-go-L27" class="blob-num js-line-number" data-line-number="27"></td> <td id="file-login_controller_test-go-LC27" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L28" class="blob-num js-line-number" data-line-number="28"></td> <td id="file-login_controller_test-go-LC28" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>user</span>.<span class=pl-en>Prepare</span>()</td> </tr> <tr> <td id="file-login_controller_test-go-L29" class="blob-num js-line-number" data-line-number="29"></td> <td id="file-login_controller_test-go-LC29" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>user</span>.<span class=pl-en>Validate</span>(<span class=pl-s>&quot;login&quot;</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L30" class="blob-num js-line-number" data-line-number="30"></td> <td id="file-login_controller_test-go-LC30" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-login_controller_test-go-L31" class="blob-num js-line-number" data-line-number="31"></td> <td id="file-login_controller_test-go-LC31" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L32" class="blob-num js-line-number" data-line-number="32"></td> <td id="file-login_controller_test-go-LC32" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-login_controller_test-go-L33" class="blob-num js-line-number" data-line-number="33"></td> <td id="file-login_controller_test-go-LC33" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-login_controller_test-go-L34" class="blob-num js-line-number" data-line-number="34"></td> <td id="file-login_controller_test-go-LC34" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>token</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>server</span>.<span class=pl-en>SignIn</span>(<span class=pl-s1>user</span>.<span class=pl-c1>Email</span>, <span class=pl-s1>user</span>.<span class=pl-c1>Password</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L35" class="blob-num js-line-number" data-line-number="35"></td> <td id="file-login_controller_test-go-LC35" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-login_controller_test-go-L36" class="blob-num js-line-number" data-line-number="36"></td> <td id="file-login_controller_test-go-LC36" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>formattedError</span> <span class=pl-c1>:=</span> <span class=pl-s1>formaterror</span>.<span class=pl-en>FormatError</span>(<span class=pl-s1>err</span>.<span class=pl-en>Error</span>())</td> </tr> <tr> <td id="file-login_controller_test-go-L37" class="blob-num js-line-number" data-line-number="37"></td> <td id="file-login_controller_test-go-LC37" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>formattedError</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L38" class="blob-num js-line-number" data-line-number="38"></td> <td id="file-login_controller_test-go-LC38" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-login_controller_test-go-L39" class="blob-num js-line-number" data-line-number="39"></td> <td id="file-login_controller_test-go-LC39" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-login_controller_test-go-L40" class="blob-num js-line-number" data-line-number="40"></td> <td id="file-login_controller_test-go-LC40" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>JSON</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusOK</span>, <span class=pl-s1>token</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L41" class="blob-num js-line-number" data-line-number="41"></td> <td id="file-login_controller_test-go-LC41" class="blob-code blob-code-inner js-file-line">}</td> </tr> <tr> <td id="file-login_controller_test-go-L42" class="blob-num js-line-number" data-line-number="42"></td> <td id="file-login_controller_test-go-LC42" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L43" class="blob-num js-line-number" data-line-number="43"></td> <td id="file-login_controller_test-go-LC43" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>SignIn</span>(<span class=pl-s1>email</span>, <span class=pl-s1>password</span> <span class=pl-smi>string</span>) (<span class=pl-smi>string</span>, <span class=pl-smi>error</span>) {</td> </tr> <tr> <td id="file-login_controller_test-go-L44" class="blob-num js-line-number" data-line-number="44"></td> <td id="file-login_controller_test-go-LC44" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L45" class="blob-num js-line-number" data-line-number="45"></td> <td id="file-login_controller_test-go-LC45" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>var</span> <span class=pl-s1>err</span> <span class=pl-smi>error</span></td> </tr> <tr> <td id="file-login_controller_test-go-L46" class="blob-num js-line-number" data-line-number="46"></td> <td id="file-login_controller_test-go-LC46" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L47" class="blob-num js-line-number" data-line-number="47"></td> <td id="file-login_controller_test-go-LC47" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>user</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>User</span>{}</td> </tr> <tr> <td id="file-login_controller_test-go-L48" class="blob-num js-line-number" data-line-number="48"></td> <td id="file-login_controller_test-go-LC48" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-login_controller_test-go-L49" class="blob-num js-line-number" data-line-number="49"></td> <td id="file-login_controller_test-go-LC49" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>server</span>.<span class=pl-c1>DB</span>.<span class=pl-en>Debug</span>().<span class=pl-en>Model</span>(models.<span class=pl-smi>User</span>{}).<span class=pl-en>Where</span>(<span class=pl-s>&quot;email = ?&quot;</span>, <span class=pl-s1>email</span>).<span class=pl-en>Take</span>(<span class=pl-c1>&amp;</span><span class=pl-s1>user</span>).<span class=pl-c1>Error</span></td> </tr> <tr> <td id="file-login_controller_test-go-L50" class="blob-num js-line-number" data-line-number="50"></td> <td id="file-login_controller_test-go-LC50" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-login_controller_test-go-L51" class="blob-num js-line-number" data-line-number="51"></td> <td id="file-login_controller_test-go-LC51" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span> <span class=pl-s>&quot;&quot;</span>, <span class=pl-s1>err</span></td> </tr> <tr> <td id="file-login_controller_test-go-L52" class="blob-num js-line-number" data-line-number="52"></td> <td id="file-login_controller_test-go-LC52" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-login_controller_test-go-L53" class="blob-num js-line-number" data-line-number="53"></td> <td id="file-login_controller_test-go-LC53" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>models</span>.<span class=pl-en>VerifyPassword</span>(<span class=pl-s1>user</span>.<span class=pl-c1>Password</span>, <span class=pl-s1>password</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L54" class="blob-num js-line-number" data-line-number="54"></td> <td id="file-login_controller_test-go-LC54" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> <span class=pl-c1>&amp;&amp;</span> <span class=pl-s1>err</span> <span class=pl-c1>==</span> <span class=pl-s1>bcrypt</span>.<span class=pl-c1>ErrMismatchedHashAndPassword</span> {</td> </tr> <tr> <td id="file-login_controller_test-go-L55" class="blob-num js-line-number" data-line-number="55"></td> <td id="file-login_controller_test-go-LC55" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span> <span class=pl-s>&quot;&quot;</span>, <span class=pl-s1>err</span></td> </tr> <tr> <td id="file-login_controller_test-go-L56" class="blob-num js-line-number" data-line-number="56"></td> <td id="file-login_controller_test-go-LC56" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-login_controller_test-go-L57" class="blob-num js-line-number" data-line-number="57"></td> <td id="file-login_controller_test-go-LC57" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span> <span class=pl-s1>auth</span>.<span class=pl-en>CreateToken</span>(<span class=pl-s1>user</span>.<span class=pl-c1>ID</span>)</td> </tr> <tr> <td id="file-login_controller_test-go-L58" class="blob-num js-line-number" data-line-number="58"></td> <td id="file-login_controller_test-go-LC58" class="blob-code blob-code-inner js-file-line">}</td> </tr> </table> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/victorsteven/b8129dee99480eeaae415a7a77d49d42/raw/f84f11a907cc5edd7033f9b2902336071237f77a/login_controller_test.go" style="float:right">view raw</a> <a href="https://gist.github.com/victorsteven/b8129dee99480eeaae415a7a77d49d42#file-login_controller_test-go">login_controller_test.go</a> hosted with &#10084; by <a href="https://github.com">GitHub</a> </div> </div> </div>