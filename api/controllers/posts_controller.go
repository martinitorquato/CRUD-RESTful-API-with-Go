<div id="gist97984988" class="gist"> <div class="gist-file"> <div class="gist-data"> <div class="js-gist-file-update-container js-task-list-container file-box"> <div id="file-posts_controller-go" class="file my-2"> <div itemprop="text" class="Box-body p-0 blob-wrapper data type-go "> <table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip> <tr> <td id="file-posts_controller-go-L1" class="blob-num js-line-number" data-line-number="1"></td> <td id="file-posts_controller-go-LC1" class="blob-code blob-code-inner js-file-line"><span class=pl-k>package</span> controllers</td> </tr> <tr> <td id="file-posts_controller-go-L2" class="blob-num js-line-number" data-line-number="2"></td> <td id="file-posts_controller-go-LC2" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L3" class="blob-num js-line-number" data-line-number="3"></td> <td id="file-posts_controller-go-LC3" class="blob-code blob-code-inner js-file-line"><span class=pl-k>import</span> (</td> </tr> <tr> <td id="file-posts_controller-go-L4" class="blob-num js-line-number" data-line-number="4"></td> <td id="file-posts_controller-go-LC4" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;encoding/json&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L5" class="blob-num js-line-number" data-line-number="5"></td> <td id="file-posts_controller-go-LC5" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;errors&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L6" class="blob-num js-line-number" data-line-number="6"></td> <td id="file-posts_controller-go-LC6" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;fmt&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L7" class="blob-num js-line-number" data-line-number="7"></td> <td id="file-posts_controller-go-LC7" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;io/ioutil&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L8" class="blob-num js-line-number" data-line-number="8"></td> <td id="file-posts_controller-go-LC8" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;net/http&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L9" class="blob-num js-line-number" data-line-number="9"></td> <td id="file-posts_controller-go-LC9" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;strconv&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L10" class="blob-num js-line-number" data-line-number="10"></td> <td id="file-posts_controller-go-LC10" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L11" class="blob-num js-line-number" data-line-number="11"></td> <td id="file-posts_controller-go-LC11" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/gorilla/mux&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L12" class="blob-num js-line-number" data-line-number="12"></td> <td id="file-posts_controller-go-LC12" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/auth&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L13" class="blob-num js-line-number" data-line-number="13"></td> <td id="file-posts_controller-go-LC13" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/models&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L14" class="blob-num js-line-number" data-line-number="14"></td> <td id="file-posts_controller-go-LC14" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/responses&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L15" class="blob-num js-line-number" data-line-number="15"></td> <td id="file-posts_controller-go-LC15" class="blob-code blob-code-inner js-file-line"> <span class=pl-s>&quot;github.com/victorsteven/fullstack/api/utils/formaterror&quot;</span></td> </tr> <tr> <td id="file-posts_controller-go-L16" class="blob-num js-line-number" data-line-number="16"></td> <td id="file-posts_controller-go-LC16" class="blob-code blob-code-inner js-file-line">)</td> </tr> <tr> <td id="file-posts_controller-go-L17" class="blob-num js-line-number" data-line-number="17"></td> <td id="file-posts_controller-go-LC17" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L18" class="blob-num js-line-number" data-line-number="18"></td> <td id="file-posts_controller-go-LC18" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>CreatePost</span>(<span class=pl-s1>w</span> http.<span class=pl-smi>ResponseWriter</span>, <span class=pl-s1>r</span> <span class=pl-c1>*</span>http.<span class=pl-smi>Request</span>) {</td> </tr> <tr> <td id="file-posts_controller-go-L19" class="blob-num js-line-number" data-line-number="19"></td> <td id="file-posts_controller-go-LC19" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L20" class="blob-num js-line-number" data-line-number="20"></td> <td id="file-posts_controller-go-LC20" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>body</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>ioutil</span>.<span class=pl-en>ReadAll</span>(<span class=pl-s1>r</span>.<span class=pl-c1>Body</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L21" class="blob-num js-line-number" data-line-number="21"></td> <td id="file-posts_controller-go-LC21" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L22" class="blob-num js-line-number" data-line-number="22"></td> <td id="file-posts_controller-go-LC22" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L23" class="blob-num js-line-number" data-line-number="23"></td> <td id="file-posts_controller-go-LC23" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L24" class="blob-num js-line-number" data-line-number="24"></td> <td id="file-posts_controller-go-LC24" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L25" class="blob-num js-line-number" data-line-number="25"></td> <td id="file-posts_controller-go-LC25" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>post</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>Post</span>{}</td> </tr> <tr> <td id="file-posts_controller-go-L26" class="blob-num js-line-number" data-line-number="26"></td> <td id="file-posts_controller-go-LC26" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>json</span>.<span class=pl-en>Unmarshal</span>(<span class=pl-s1>body</span>, <span class=pl-c1>&amp;</span><span class=pl-s1>post</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L27" class="blob-num js-line-number" data-line-number="27"></td> <td id="file-posts_controller-go-LC27" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L28" class="blob-num js-line-number" data-line-number="28"></td> <td id="file-posts_controller-go-LC28" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L29" class="blob-num js-line-number" data-line-number="29"></td> <td id="file-posts_controller-go-LC29" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L30" class="blob-num js-line-number" data-line-number="30"></td> <td id="file-posts_controller-go-LC30" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L31" class="blob-num js-line-number" data-line-number="31"></td> <td id="file-posts_controller-go-LC31" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>post</span>.<span class=pl-en>Prepare</span>()</td> </tr> <tr> <td id="file-posts_controller-go-L32" class="blob-num js-line-number" data-line-number="32"></td> <td id="file-posts_controller-go-LC32" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>post</span>.<span class=pl-en>Validate</span>()</td> </tr> <tr> <td id="file-posts_controller-go-L33" class="blob-num js-line-number" data-line-number="33"></td> <td id="file-posts_controller-go-LC33" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L34" class="blob-num js-line-number" data-line-number="34"></td> <td id="file-posts_controller-go-LC34" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L35" class="blob-num js-line-number" data-line-number="35"></td> <td id="file-posts_controller-go-LC35" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L36" class="blob-num js-line-number" data-line-number="36"></td> <td id="file-posts_controller-go-LC36" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L37" class="blob-num js-line-number" data-line-number="37"></td> <td id="file-posts_controller-go-LC37" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>uid</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>auth</span>.<span class=pl-en>ExtractTokenID</span>(<span class=pl-s1>r</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L38" class="blob-num js-line-number" data-line-number="38"></td> <td id="file-posts_controller-go-LC38" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L39" class="blob-num js-line-number" data-line-number="39"></td> <td id="file-posts_controller-go-LC39" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L40" class="blob-num js-line-number" data-line-number="40"></td> <td id="file-posts_controller-go-LC40" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L41" class="blob-num js-line-number" data-line-number="41"></td> <td id="file-posts_controller-go-LC41" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L42" class="blob-num js-line-number" data-line-number="42"></td> <td id="file-posts_controller-go-LC42" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>uid</span> <span class=pl-c1>!=</span> <span class=pl-s1>post</span>.<span class=pl-c1>AuthorID</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L43" class="blob-num js-line-number" data-line-number="43"></td> <td id="file-posts_controller-go-LC43" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s1>http</span>.<span class=pl-en>StatusText</span>(<span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>)))</td> </tr> <tr> <td id="file-posts_controller-go-L44" class="blob-num js-line-number" data-line-number="44"></td> <td id="file-posts_controller-go-LC44" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L45" class="blob-num js-line-number" data-line-number="45"></td> <td id="file-posts_controller-go-LC45" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L46" class="blob-num js-line-number" data-line-number="46"></td> <td id="file-posts_controller-go-LC46" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>postCreated</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>post</span>.<span class=pl-en>SavePost</span>(<span class=pl-s1>server</span>.<span class=pl-c1>DB</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L47" class="blob-num js-line-number" data-line-number="47"></td> <td id="file-posts_controller-go-LC47" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L48" class="blob-num js-line-number" data-line-number="48"></td> <td id="file-posts_controller-go-LC48" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>formattedError</span> <span class=pl-c1>:=</span> <span class=pl-s1>formaterror</span>.<span class=pl-en>FormatError</span>(<span class=pl-s1>err</span>.<span class=pl-en>Error</span>())</td> </tr> <tr> <td id="file-posts_controller-go-L49" class="blob-num js-line-number" data-line-number="49"></td> <td id="file-posts_controller-go-LC49" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusInternalServerError</span>, <span class=pl-s1>formattedError</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L50" class="blob-num js-line-number" data-line-number="50"></td> <td id="file-posts_controller-go-LC50" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L51" class="blob-num js-line-number" data-line-number="51"></td> <td id="file-posts_controller-go-LC51" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L52" class="blob-num js-line-number" data-line-number="52"></td> <td id="file-posts_controller-go-LC52" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>w</span>.<span class=pl-en>Header</span>().<span class=pl-en>Set</span>(<span class=pl-s>&quot;Lacation&quot;</span>, <span class=pl-s1>fmt</span>.<span class=pl-en>Sprintf</span>(<span class=pl-s>&quot;%s%s/%d&quot;</span>, <span class=pl-s1>r</span>.<span class=pl-c1>Host</span>, <span class=pl-s1>r</span>.<span class=pl-c1>URL</span>.<span class=pl-c1>Path</span>, <span class=pl-s1>postCreated</span>.<span class=pl-c1>ID</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L53" class="blob-num js-line-number" data-line-number="53"></td> <td id="file-posts_controller-go-LC53" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>JSON</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusCreated</span>, <span class=pl-s1>postCreated</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L54" class="blob-num js-line-number" data-line-number="54"></td> <td id="file-posts_controller-go-LC54" class="blob-code blob-code-inner js-file-line">}</td> </tr> <tr> <td id="file-posts_controller-go-L55" class="blob-num js-line-number" data-line-number="55"></td> <td id="file-posts_controller-go-LC55" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L56" class="blob-num js-line-number" data-line-number="56"></td> <td id="file-posts_controller-go-LC56" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>GetPosts</span>(<span class=pl-s1>w</span> http.<span class=pl-smi>ResponseWriter</span>, <span class=pl-s1>r</span> <span class=pl-c1>*</span>http.<span class=pl-smi>Request</span>) {</td> </tr> <tr> <td id="file-posts_controller-go-L57" class="blob-num js-line-number" data-line-number="57"></td> <td id="file-posts_controller-go-LC57" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L58" class="blob-num js-line-number" data-line-number="58"></td> <td id="file-posts_controller-go-LC58" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>post</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>Post</span>{}</td> </tr> <tr> <td id="file-posts_controller-go-L59" class="blob-num js-line-number" data-line-number="59"></td> <td id="file-posts_controller-go-LC59" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L60" class="blob-num js-line-number" data-line-number="60"></td> <td id="file-posts_controller-go-LC60" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>posts</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>post</span>.<span class=pl-en>FindAllPosts</span>(<span class=pl-s1>server</span>.<span class=pl-c1>DB</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L61" class="blob-num js-line-number" data-line-number="61"></td> <td id="file-posts_controller-go-LC61" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L62" class="blob-num js-line-number" data-line-number="62"></td> <td id="file-posts_controller-go-LC62" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusInternalServerError</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L63" class="blob-num js-line-number" data-line-number="63"></td> <td id="file-posts_controller-go-LC63" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L64" class="blob-num js-line-number" data-line-number="64"></td> <td id="file-posts_controller-go-LC64" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L65" class="blob-num js-line-number" data-line-number="65"></td> <td id="file-posts_controller-go-LC65" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>JSON</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusOK</span>, <span class=pl-s1>posts</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L66" class="blob-num js-line-number" data-line-number="66"></td> <td id="file-posts_controller-go-LC66" class="blob-code blob-code-inner js-file-line">}</td> </tr> <tr> <td id="file-posts_controller-go-L67" class="blob-num js-line-number" data-line-number="67"></td> <td id="file-posts_controller-go-LC67" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L68" class="blob-num js-line-number" data-line-number="68"></td> <td id="file-posts_controller-go-LC68" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>GetPost</span>(<span class=pl-s1>w</span> http.<span class=pl-smi>ResponseWriter</span>, <span class=pl-s1>r</span> <span class=pl-c1>*</span>http.<span class=pl-smi>Request</span>) {</td> </tr> <tr> <td id="file-posts_controller-go-L69" class="blob-num js-line-number" data-line-number="69"></td> <td id="file-posts_controller-go-LC69" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L70" class="blob-num js-line-number" data-line-number="70"></td> <td id="file-posts_controller-go-LC70" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>vars</span> <span class=pl-c1>:=</span> <span class=pl-s1>mux</span>.<span class=pl-en>Vars</span>(<span class=pl-s1>r</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L71" class="blob-num js-line-number" data-line-number="71"></td> <td id="file-posts_controller-go-LC71" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>pid</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>strconv</span>.<span class=pl-en>ParseUint</span>(<span class=pl-s1>vars</span>[<span class=pl-s>&quot;id&quot;</span>], <span class=pl-c1>10</span>, <span class=pl-c1>64</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L72" class="blob-num js-line-number" data-line-number="72"></td> <td id="file-posts_controller-go-LC72" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L73" class="blob-num js-line-number" data-line-number="73"></td> <td id="file-posts_controller-go-LC73" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusBadRequest</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L74" class="blob-num js-line-number" data-line-number="74"></td> <td id="file-posts_controller-go-LC74" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L75" class="blob-num js-line-number" data-line-number="75"></td> <td id="file-posts_controller-go-LC75" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L76" class="blob-num js-line-number" data-line-number="76"></td> <td id="file-posts_controller-go-LC76" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>post</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>Post</span>{}</td> </tr> <tr> <td id="file-posts_controller-go-L77" class="blob-num js-line-number" data-line-number="77"></td> <td id="file-posts_controller-go-LC77" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L78" class="blob-num js-line-number" data-line-number="78"></td> <td id="file-posts_controller-go-LC78" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>postReceived</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>post</span>.<span class=pl-en>FindPostByID</span>(<span class=pl-s1>server</span>.<span class=pl-c1>DB</span>, <span class=pl-s1>pid</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L79" class="blob-num js-line-number" data-line-number="79"></td> <td id="file-posts_controller-go-LC79" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L80" class="blob-num js-line-number" data-line-number="80"></td> <td id="file-posts_controller-go-LC80" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusInternalServerError</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L81" class="blob-num js-line-number" data-line-number="81"></td> <td id="file-posts_controller-go-LC81" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L82" class="blob-num js-line-number" data-line-number="82"></td> <td id="file-posts_controller-go-LC82" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L83" class="blob-num js-line-number" data-line-number="83"></td> <td id="file-posts_controller-go-LC83" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>JSON</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusOK</span>, <span class=pl-s1>postReceived</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L84" class="blob-num js-line-number" data-line-number="84"></td> <td id="file-posts_controller-go-LC84" class="blob-code blob-code-inner js-file-line">}</td> </tr> <tr> <td id="file-posts_controller-go-L85" class="blob-num js-line-number" data-line-number="85"></td> <td id="file-posts_controller-go-LC85" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L86" class="blob-num js-line-number" data-line-number="86"></td> <td id="file-posts_controller-go-LC86" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>UpdatePost</span>(<span class=pl-s1>w</span> http.<span class=pl-smi>ResponseWriter</span>, <span class=pl-s1>r</span> <span class=pl-c1>*</span>http.<span class=pl-smi>Request</span>) {</td> </tr> <tr> <td id="file-posts_controller-go-L87" class="blob-num js-line-number" data-line-number="87"></td> <td id="file-posts_controller-go-LC87" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L88" class="blob-num js-line-number" data-line-number="88"></td> <td id="file-posts_controller-go-LC88" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>vars</span> <span class=pl-c1>:=</span> <span class=pl-s1>mux</span>.<span class=pl-en>Vars</span>(<span class=pl-s1>r</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L89" class="blob-num js-line-number" data-line-number="89"></td> <td id="file-posts_controller-go-LC89" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L90" class="blob-num js-line-number" data-line-number="90"></td> <td id="file-posts_controller-go-LC90" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Check if the post id is valid</span></td> </tr> <tr> <td id="file-posts_controller-go-L91" class="blob-num js-line-number" data-line-number="91"></td> <td id="file-posts_controller-go-LC91" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>pid</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>strconv</span>.<span class=pl-en>ParseUint</span>(<span class=pl-s1>vars</span>[<span class=pl-s>&quot;id&quot;</span>], <span class=pl-c1>10</span>, <span class=pl-c1>64</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L92" class="blob-num js-line-number" data-line-number="92"></td> <td id="file-posts_controller-go-LC92" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L93" class="blob-num js-line-number" data-line-number="93"></td> <td id="file-posts_controller-go-LC93" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusBadRequest</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L94" class="blob-num js-line-number" data-line-number="94"></td> <td id="file-posts_controller-go-LC94" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L95" class="blob-num js-line-number" data-line-number="95"></td> <td id="file-posts_controller-go-LC95" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L96" class="blob-num js-line-number" data-line-number="96"></td> <td id="file-posts_controller-go-LC96" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L97" class="blob-num js-line-number" data-line-number="97"></td> <td id="file-posts_controller-go-LC97" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>//CHeck if the auth token is valid and get the user id from it</span></td> </tr> <tr> <td id="file-posts_controller-go-L98" class="blob-num js-line-number" data-line-number="98"></td> <td id="file-posts_controller-go-LC98" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>uid</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>auth</span>.<span class=pl-en>ExtractTokenID</span>(<span class=pl-s1>r</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L99" class="blob-num js-line-number" data-line-number="99"></td> <td id="file-posts_controller-go-LC99" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L100" class="blob-num js-line-number" data-line-number="100"></td> <td id="file-posts_controller-go-LC100" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L101" class="blob-num js-line-number" data-line-number="101"></td> <td id="file-posts_controller-go-LC101" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L102" class="blob-num js-line-number" data-line-number="102"></td> <td id="file-posts_controller-go-LC102" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L103" class="blob-num js-line-number" data-line-number="103"></td> <td id="file-posts_controller-go-LC103" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L104" class="blob-num js-line-number" data-line-number="104"></td> <td id="file-posts_controller-go-LC104" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Check if the post exist</span></td> </tr> <tr> <td id="file-posts_controller-go-L105" class="blob-num js-line-number" data-line-number="105"></td> <td id="file-posts_controller-go-LC105" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>post</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>Post</span>{}</td> </tr> <tr> <td id="file-posts_controller-go-L106" class="blob-num js-line-number" data-line-number="106"></td> <td id="file-posts_controller-go-LC106" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>server</span>.<span class=pl-c1>DB</span>.<span class=pl-en>Debug</span>().<span class=pl-en>Model</span>(models.<span class=pl-smi>Post</span>{}).<span class=pl-en>Where</span>(<span class=pl-s>&quot;id = ?&quot;</span>, <span class=pl-s1>pid</span>).<span class=pl-en>Take</span>(<span class=pl-c1>&amp;</span><span class=pl-s1>post</span>).<span class=pl-c1>Error</span></td> </tr> <tr> <td id="file-posts_controller-go-L107" class="blob-num js-line-number" data-line-number="107"></td> <td id="file-posts_controller-go-LC107" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L108" class="blob-num js-line-number" data-line-number="108"></td> <td id="file-posts_controller-go-LC108" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusNotFound</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Post not found&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L109" class="blob-num js-line-number" data-line-number="109"></td> <td id="file-posts_controller-go-LC109" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L110" class="blob-num js-line-number" data-line-number="110"></td> <td id="file-posts_controller-go-LC110" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L111" class="blob-num js-line-number" data-line-number="111"></td> <td id="file-posts_controller-go-LC111" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L112" class="blob-num js-line-number" data-line-number="112"></td> <td id="file-posts_controller-go-LC112" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// If a user attempt to update a post not belonging to him</span></td> </tr> <tr> <td id="file-posts_controller-go-L113" class="blob-num js-line-number" data-line-number="113"></td> <td id="file-posts_controller-go-LC113" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>uid</span> <span class=pl-c1>!=</span> <span class=pl-s1>post</span>.<span class=pl-c1>AuthorID</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L114" class="blob-num js-line-number" data-line-number="114"></td> <td id="file-posts_controller-go-LC114" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L115" class="blob-num js-line-number" data-line-number="115"></td> <td id="file-posts_controller-go-LC115" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L116" class="blob-num js-line-number" data-line-number="116"></td> <td id="file-posts_controller-go-LC116" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L117" class="blob-num js-line-number" data-line-number="117"></td> <td id="file-posts_controller-go-LC117" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Read the data posted</span></td> </tr> <tr> <td id="file-posts_controller-go-L118" class="blob-num js-line-number" data-line-number="118"></td> <td id="file-posts_controller-go-LC118" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>body</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>ioutil</span>.<span class=pl-en>ReadAll</span>(<span class=pl-s1>r</span>.<span class=pl-c1>Body</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L119" class="blob-num js-line-number" data-line-number="119"></td> <td id="file-posts_controller-go-LC119" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L120" class="blob-num js-line-number" data-line-number="120"></td> <td id="file-posts_controller-go-LC120" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L121" class="blob-num js-line-number" data-line-number="121"></td> <td id="file-posts_controller-go-LC121" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L122" class="blob-num js-line-number" data-line-number="122"></td> <td id="file-posts_controller-go-LC122" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L123" class="blob-num js-line-number" data-line-number="123"></td> <td id="file-posts_controller-go-LC123" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L124" class="blob-num js-line-number" data-line-number="124"></td> <td id="file-posts_controller-go-LC124" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Start processing the request data</span></td> </tr> <tr> <td id="file-posts_controller-go-L125" class="blob-num js-line-number" data-line-number="125"></td> <td id="file-posts_controller-go-LC125" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>postUpdate</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>Post</span>{}</td> </tr> <tr> <td id="file-posts_controller-go-L126" class="blob-num js-line-number" data-line-number="126"></td> <td id="file-posts_controller-go-LC126" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>json</span>.<span class=pl-en>Unmarshal</span>(<span class=pl-s1>body</span>, <span class=pl-c1>&amp;</span><span class=pl-s1>postUpdate</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L127" class="blob-num js-line-number" data-line-number="127"></td> <td id="file-posts_controller-go-LC127" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L128" class="blob-num js-line-number" data-line-number="128"></td> <td id="file-posts_controller-go-LC128" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L129" class="blob-num js-line-number" data-line-number="129"></td> <td id="file-posts_controller-go-LC129" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L130" class="blob-num js-line-number" data-line-number="130"></td> <td id="file-posts_controller-go-LC130" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L131" class="blob-num js-line-number" data-line-number="131"></td> <td id="file-posts_controller-go-LC131" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L132" class="blob-num js-line-number" data-line-number="132"></td> <td id="file-posts_controller-go-LC132" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>//Also check if the request user id is equal to the one gotten from token</span></td> </tr> <tr> <td id="file-posts_controller-go-L133" class="blob-num js-line-number" data-line-number="133"></td> <td id="file-posts_controller-go-LC133" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>uid</span> <span class=pl-c1>!=</span> <span class=pl-s1>postUpdate</span>.<span class=pl-c1>AuthorID</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L134" class="blob-num js-line-number" data-line-number="134"></td> <td id="file-posts_controller-go-LC134" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L135" class="blob-num js-line-number" data-line-number="135"></td> <td id="file-posts_controller-go-LC135" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L136" class="blob-num js-line-number" data-line-number="136"></td> <td id="file-posts_controller-go-LC136" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L137" class="blob-num js-line-number" data-line-number="137"></td> <td id="file-posts_controller-go-LC137" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L138" class="blob-num js-line-number" data-line-number="138"></td> <td id="file-posts_controller-go-LC138" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>postUpdate</span>.<span class=pl-en>Prepare</span>()</td> </tr> <tr> <td id="file-posts_controller-go-L139" class="blob-num js-line-number" data-line-number="139"></td> <td id="file-posts_controller-go-LC139" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>postUpdate</span>.<span class=pl-en>Validate</span>()</td> </tr> <tr> <td id="file-posts_controller-go-L140" class="blob-num js-line-number" data-line-number="140"></td> <td id="file-posts_controller-go-LC140" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L141" class="blob-num js-line-number" data-line-number="141"></td> <td id="file-posts_controller-go-LC141" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnprocessableEntity</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L142" class="blob-num js-line-number" data-line-number="142"></td> <td id="file-posts_controller-go-LC142" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L143" class="blob-num js-line-number" data-line-number="143"></td> <td id="file-posts_controller-go-LC143" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L144" class="blob-num js-line-number" data-line-number="144"></td> <td id="file-posts_controller-go-LC144" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L145" class="blob-num js-line-number" data-line-number="145"></td> <td id="file-posts_controller-go-LC145" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>postUpdate</span>.<span class=pl-c1>ID</span> <span class=pl-c1>=</span> <span class=pl-s1>post</span>.<span class=pl-c1>ID</span> <span class=pl-c>//this is important to tell the model the post id to update, the other update field are set above</span></td> </tr> <tr> <td id="file-posts_controller-go-L146" class="blob-num js-line-number" data-line-number="146"></td> <td id="file-posts_controller-go-LC146" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L147" class="blob-num js-line-number" data-line-number="147"></td> <td id="file-posts_controller-go-LC147" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>postUpdated</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>postUpdate</span>.<span class=pl-en>UpdateAPost</span>(<span class=pl-s1>server</span>.<span class=pl-c1>DB</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L148" class="blob-num js-line-number" data-line-number="148"></td> <td id="file-posts_controller-go-LC148" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L149" class="blob-num js-line-number" data-line-number="149"></td> <td id="file-posts_controller-go-LC149" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L150" class="blob-num js-line-number" data-line-number="150"></td> <td id="file-posts_controller-go-LC150" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>formattedError</span> <span class=pl-c1>:=</span> <span class=pl-s1>formaterror</span>.<span class=pl-en>FormatError</span>(<span class=pl-s1>err</span>.<span class=pl-en>Error</span>())</td> </tr> <tr> <td id="file-posts_controller-go-L151" class="blob-num js-line-number" data-line-number="151"></td> <td id="file-posts_controller-go-LC151" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusInternalServerError</span>, <span class=pl-s1>formattedError</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L152" class="blob-num js-line-number" data-line-number="152"></td> <td id="file-posts_controller-go-LC152" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L153" class="blob-num js-line-number" data-line-number="153"></td> <td id="file-posts_controller-go-LC153" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L154" class="blob-num js-line-number" data-line-number="154"></td> <td id="file-posts_controller-go-LC154" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>JSON</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusOK</span>, <span class=pl-s1>postUpdated</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L155" class="blob-num js-line-number" data-line-number="155"></td> <td id="file-posts_controller-go-LC155" class="blob-code blob-code-inner js-file-line">}</td> </tr> <tr> <td id="file-posts_controller-go-L156" class="blob-num js-line-number" data-line-number="156"></td> <td id="file-posts_controller-go-LC156" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L157" class="blob-num js-line-number" data-line-number="157"></td> <td id="file-posts_controller-go-LC157" class="blob-code blob-code-inner js-file-line"><span class=pl-k>func</span> (<span class=pl-s1>server</span> <span class=pl-c1>*</span><span class=pl-smi>Server</span>) <span class=pl-en>DeletePost</span>(<span class=pl-s1>w</span> http.<span class=pl-smi>ResponseWriter</span>, <span class=pl-s1>r</span> <span class=pl-c1>*</span>http.<span class=pl-smi>Request</span>) {</td> </tr> <tr> <td id="file-posts_controller-go-L158" class="blob-num js-line-number" data-line-number="158"></td> <td id="file-posts_controller-go-LC158" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L159" class="blob-num js-line-number" data-line-number="159"></td> <td id="file-posts_controller-go-LC159" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>vars</span> <span class=pl-c1>:=</span> <span class=pl-s1>mux</span>.<span class=pl-en>Vars</span>(<span class=pl-s1>r</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L160" class="blob-num js-line-number" data-line-number="160"></td> <td id="file-posts_controller-go-LC160" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L161" class="blob-num js-line-number" data-line-number="161"></td> <td id="file-posts_controller-go-LC161" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Is a valid post id given to us?</span></td> </tr> <tr> <td id="file-posts_controller-go-L162" class="blob-num js-line-number" data-line-number="162"></td> <td id="file-posts_controller-go-LC162" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>pid</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>strconv</span>.<span class=pl-en>ParseUint</span>(<span class=pl-s1>vars</span>[<span class=pl-s>&quot;id&quot;</span>], <span class=pl-c1>10</span>, <span class=pl-c1>64</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L163" class="blob-num js-line-number" data-line-number="163"></td> <td id="file-posts_controller-go-LC163" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L164" class="blob-num js-line-number" data-line-number="164"></td> <td id="file-posts_controller-go-LC164" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusBadRequest</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L165" class="blob-num js-line-number" data-line-number="165"></td> <td id="file-posts_controller-go-LC165" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L166" class="blob-num js-line-number" data-line-number="166"></td> <td id="file-posts_controller-go-LC166" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L167" class="blob-num js-line-number" data-line-number="167"></td> <td id="file-posts_controller-go-LC167" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L168" class="blob-num js-line-number" data-line-number="168"></td> <td id="file-posts_controller-go-LC168" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Is this user authenticated?</span></td> </tr> <tr> <td id="file-posts_controller-go-L169" class="blob-num js-line-number" data-line-number="169"></td> <td id="file-posts_controller-go-LC169" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>uid</span>, <span class=pl-s1>err</span> <span class=pl-c1>:=</span> <span class=pl-s1>auth</span>.<span class=pl-en>ExtractTokenID</span>(<span class=pl-s1>r</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L170" class="blob-num js-line-number" data-line-number="170"></td> <td id="file-posts_controller-go-LC170" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L171" class="blob-num js-line-number" data-line-number="171"></td> <td id="file-posts_controller-go-LC171" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L172" class="blob-num js-line-number" data-line-number="172"></td> <td id="file-posts_controller-go-LC172" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L173" class="blob-num js-line-number" data-line-number="173"></td> <td id="file-posts_controller-go-LC173" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L174" class="blob-num js-line-number" data-line-number="174"></td> <td id="file-posts_controller-go-LC174" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L175" class="blob-num js-line-number" data-line-number="175"></td> <td id="file-posts_controller-go-LC175" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Check if the post exist</span></td> </tr> <tr> <td id="file-posts_controller-go-L176" class="blob-num js-line-number" data-line-number="176"></td> <td id="file-posts_controller-go-LC176" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>post</span> <span class=pl-c1>:=</span> models.<span class=pl-smi>Post</span>{}</td> </tr> <tr> <td id="file-posts_controller-go-L177" class="blob-num js-line-number" data-line-number="177"></td> <td id="file-posts_controller-go-LC177" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>server</span>.<span class=pl-c1>DB</span>.<span class=pl-en>Debug</span>().<span class=pl-en>Model</span>(models.<span class=pl-smi>Post</span>{}).<span class=pl-en>Where</span>(<span class=pl-s>&quot;id = ?&quot;</span>, <span class=pl-s1>pid</span>).<span class=pl-en>Take</span>(<span class=pl-c1>&amp;</span><span class=pl-s1>post</span>).<span class=pl-c1>Error</span></td> </tr> <tr> <td id="file-posts_controller-go-L178" class="blob-num js-line-number" data-line-number="178"></td> <td id="file-posts_controller-go-LC178" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L179" class="blob-num js-line-number" data-line-number="179"></td> <td id="file-posts_controller-go-LC179" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusNotFound</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L180" class="blob-num js-line-number" data-line-number="180"></td> <td id="file-posts_controller-go-LC180" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L181" class="blob-num js-line-number" data-line-number="181"></td> <td id="file-posts_controller-go-LC181" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L182" class="blob-num js-line-number" data-line-number="182"></td> <td id="file-posts_controller-go-LC182" class="blob-code blob-code-inner js-file-line"> </td> </tr> <tr> <td id="file-posts_controller-go-L183" class="blob-num js-line-number" data-line-number="183"></td> <td id="file-posts_controller-go-LC183" class="blob-code blob-code-inner js-file-line"> <span class=pl-c>// Is the authenticated user, the owner of this post?</span></td> </tr> <tr> <td id="file-posts_controller-go-L184" class="blob-num js-line-number" data-line-number="184"></td> <td id="file-posts_controller-go-LC184" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>uid</span> <span class=pl-c1>!=</span> <span class=pl-s1>post</span>.<span class=pl-c1>AuthorID</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L185" class="blob-num js-line-number" data-line-number="185"></td> <td id="file-posts_controller-go-LC185" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusUnauthorized</span>, <span class=pl-s1>errors</span>.<span class=pl-en>New</span>(<span class=pl-s>&quot;Unauthorized&quot;</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L186" class="blob-num js-line-number" data-line-number="186"></td> <td id="file-posts_controller-go-LC186" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L187" class="blob-num js-line-number" data-line-number="187"></td> <td id="file-posts_controller-go-LC187" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L188" class="blob-num js-line-number" data-line-number="188"></td> <td id="file-posts_controller-go-LC188" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>_</span>, <span class=pl-s1>err</span> <span class=pl-c1>=</span> <span class=pl-s1>post</span>.<span class=pl-en>DeleteAPost</span>(<span class=pl-s1>server</span>.<span class=pl-c1>DB</span>, <span class=pl-s1>pid</span>, <span class=pl-s1>uid</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L189" class="blob-num js-line-number" data-line-number="189"></td> <td id="file-posts_controller-go-LC189" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>if</span> <span class=pl-s1>err</span> <span class=pl-c1>!=</span> <span class=pl-c1>nil</span> {</td> </tr> <tr> <td id="file-posts_controller-go-L190" class="blob-num js-line-number" data-line-number="190"></td> <td id="file-posts_controller-go-LC190" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>ERROR</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusBadRequest</span>, <span class=pl-s1>err</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L191" class="blob-num js-line-number" data-line-number="191"></td> <td id="file-posts_controller-go-LC191" class="blob-code blob-code-inner js-file-line"> <span class=pl-k>return</span></td> </tr> <tr> <td id="file-posts_controller-go-L192" class="blob-num js-line-number" data-line-number="192"></td> <td id="file-posts_controller-go-LC192" class="blob-code blob-code-inner js-file-line"> }</td> </tr> <tr> <td id="file-posts_controller-go-L193" class="blob-num js-line-number" data-line-number="193"></td> <td id="file-posts_controller-go-LC193" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>w</span>.<span class=pl-en>Header</span>().<span class=pl-en>Set</span>(<span class=pl-s>&quot;Entity&quot;</span>, <span class=pl-s1>fmt</span>.<span class=pl-en>Sprintf</span>(<span class=pl-s>&quot;%d&quot;</span>, <span class=pl-s1>pid</span>))</td> </tr> <tr> <td id="file-posts_controller-go-L194" class="blob-num js-line-number" data-line-number="194"></td> <td id="file-posts_controller-go-LC194" class="blob-code blob-code-inner js-file-line"> <span class=pl-s1>responses</span>.<span class=pl-en>JSON</span>(<span class=pl-s1>w</span>, <span class=pl-s1>http</span>.<span class=pl-c1>StatusNoContent</span>, <span class=pl-s>&quot;&quot;</span>)</td> </tr> <tr> <td id="file-posts_controller-go-L195" class="blob-num js-line-number" data-line-number="195"></td> <td id="file-posts_controller-go-LC195" class="blob-code blob-code-inner js-file-line">}</td> </tr> </table> </div> </div> </div> </div> <div class="gist-meta"> <a href="https://gist.github.com/victorsteven/baa49ba5790a5edb8205037a294d7b20/raw/0690d6bcfb6759b98fca891465c87a083079a590/posts_controller.go" style="float:right">view raw</a> <a href="https://gist.github.com/victorsteven/baa49ba5790a5edb8205037a294d7b20#file-posts_controller-go">posts_controller.go</a> hosted with &#10084; by <a href="https://github.com">GitHub</a> </div> </div> </div>